<!DOCTYPE html>

<html>
<head>
  <title>desafioApp.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>desafioApp.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*jslint browser: true*/</span>
<span class="hljs-comment">/*global angular, console, alert*/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>El código de esta aplicación fue pasado por un validador de estilo JSLint</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
angular.module(<span class="hljs-string">'desafioApp'</span>, [])
    .controller(<span class="hljs-string">'desafioController'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>‘use strict’; se utiliza para mejorar el rendimiento de ciertas funciones
habitualmente cuando es necesario hacer comparaciones y se sabe exactamente 
el tipo de datos de las variables (uso de comparaciones estrictas).        </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">        'use strict'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Por un tema de claridad (y buenas prácticas) se asigna el valor this a una variable
con el mismo nombre que el utilizado en la asignación de controllerAs
Al hacer esto se evita inyectar el $scope para todo aquello que es exclusivo de la vista,
y que no requiere explícitamente del $scope (a veces es necesario).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> dCtrl = <span class="hljs-keyword">this</span>,            
            <span class="hljs-comment">/**
            * Inicializa los objetos utilizados para el despliegue de datos en la vista
            */</span>
            init = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                dCtrl.editData   = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Carga el listado de clientes desde el arreglo de datos simulados</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                dCtrl.clientList = dummyData.clients;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Laa variable visibleClientsList hace una copia de 10 elementos segun la pagina 
que se esté visitando</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                dCtrl.visibleClientsList = dCtrl.clientList.slice(<span class="hljs-number">0</span>,<span class="hljs-number">10</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Se calcula el total de páginas
IMPORTANTE: Se debe tomar el valor entero de la división</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                dCtrl.totalPages = <span class="hljs-number">1</span>+<span class="hljs-built_in">Math</span>.floor(dCtrl.clientList.length/<span class="hljs-number">10</span>);                                
                
            }; 
    
        
        <span class="hljs-comment">/**
         * Despliega el formulario de edición de datos de cliente
         * @param JSON client Datos del cliente que se está editando
         * @param int idx    Índice del registro asociado al cliente
         */</span>
        dCtrl.editClient = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">client, idx</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Si no se realiza una copia la edicion se  efectua directamente
indepemndiente se presione o no se presione el botón de confirmación</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            dCtrl.editData = angular.copy(client);</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Muestra el formulario para actualización del cliente seleccionado
deshabilitado para la edición</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            dCtrl.showEdit = <span class="hljs-literal">true</span>;
            dCtrl.editEnabled = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Guarda del índice asociado al registro del cliente seleccionado
Este índice es propio de la vista y coincidirá con el ínidice real del registro en 
el arreglo de clientes solamente cuando NO haya paginación.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            dCtrl.activeRecord = idx;
        }
        
        <span class="hljs-comment">/**
         * Habilita el formulario para que  se puedan actualizar los campos
         */</span>
        dCtrl.enableEdit = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{            
            dCtrl.editEnabled  = <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-comment">/**
         * Actualiza el registro activo con los datos modificados del formulario
         * @param JSON updatedClient Objeto con los datos actualizados del cliente 
         */</span>
        dCtrl.updateClientInfo = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">updatedClient</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>En rigor no se está utilizando el parámetro updatedClient</p>

            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Se deshabilita la edición en el formulario</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            dCtrl.editEnabled = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>En caso de haber paginacion se calcula el índice del registro a editar
en el arreglo original</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> idx = dCtrl.activeRecord;
            <span class="hljs-keyword">if</span>(!!dCtrl.showPaged){
                idx = (dCtrl.currentPage<span class="hljs-number">-1</span>)*<span class="hljs-number">10</span>+idx;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Se asigna el valor actualizado</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            dCtrl.clientList[idx] = updatedClient;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Si hay paginación, se refresca la página actual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span>(!!dCtrl.showPaged){
                dCtrl.gotoPage(dCtrl.currentPage);
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Se despliega la alerta de confirmacion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            alert(<span class="hljs-string">'Registro actualizado'</span>);
            
        }        
        
        <span class="hljs-comment">/**
         * Limpia los campos editables del formulario
         * @param event      event Se debe pasar $event como parametro de modo de poder 
         *                         interceptar el funcionamiento por defecto del botoón 
         *                         de tipo reset
         */</span>
        dCtrl.cleanForm = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Intercepta el evento por defecto</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            event.preventDefault();</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Copia valores nulos en los campos editables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            angular.extend(dCtrl.editData, { address1: <span class="hljs-literal">null</span>,
                                             address2: <span class="hljs-literal">null</span>,
                                             rut: <span class="hljs-literal">null</span>,
                                             phone: <span class="hljs-literal">null</span> });</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>return false;            </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        }
        
        <span class="hljs-comment">/**
         * Borra el registro cuyo índice se pasa como parámetro
         * @param int idx Índice del registro a borrar
         */</span>
        dCtrl.deleteClient = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">client, idx</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>En caso de haber paginación recalcula el índice</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span>(!!dCtrl.showPaged){
                idx = (dCtrl.currentPage<span class="hljs-number">-1</span>)*<span class="hljs-number">10</span>+idx;
            }
            
            <span class="hljs-keyword">if</span>(confirm(<span class="hljs-string">'¿Esta seguro de querer eliminar el cliente '</span> + dCtrl.clientList[idx].name + <span class="hljs-string">' '</span> + dCtrl.clientList[idx].lastname + <span class="hljs-string">'?'</span>)){</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Elimina el registro de la lista original
IMPORTANTE: El método splice es destructivo, es decir afecta 
el arreglo original</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                dCtrl.clientList.splice(idx, <span class="hljs-number">1</span>);
                
                dCtrl.totalPages = <span class="hljs-number">1</span>+<span class="hljs-built_in">Math</span>.floor(dCtrl.clientList.length/<span class="hljs-number">10</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Si hay paginación, se refresca la página actual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span>(!!dCtrl.showPaged || dCtrl.currentPage === <span class="hljs-number">1</span>){
                    dCtrl.gotoPage(dCtrl.currentPage);
                }    
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Deshabilita la vista de edición</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            dCtrl.showEdit = <span class="hljs-literal">false</span>;
            
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Funciones de control de paginacion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        dCtrl.currentPage = <span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>No es necesario realizar la validación de si existe o no
página siguiente o anterior, ya que los métodos están restringidos 
por la visualización de los botones Siguiente y Anterior, que ya incorporan 
dicha validación</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    
        <span class="hljs-comment">/**
         * Se desplaza a la página anterior
         */</span>
        dCtrl.prevPage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
            dCtrl.gotoPage(dCtrl.currentPage<span class="hljs-number">-1</span>);
        }
        
        <span class="hljs-comment">/**
         * Se desplaza a la página siguiente
         */</span>
        dCtrl.nextPage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
            dCtrl.gotoPage(dCtrl.currentPage+<span class="hljs-number">1</span>);
        }
        
        <span class="hljs-comment">/**
         * Despliega los registros correspondientes a la página indicada
         * como parámetro
         * @param int page  Página de destino
         * @param event event opcional) Evento para interceptar la accion por defecto
         */</span>
        dCtrl.gotoPage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">page, event</span>)</span>{
            <span class="hljs-keyword">if</span>(!!event) event.preventDefault();            
            dCtrl.currentPage = page;</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Saca un segmento de 10 registros desde el arreglo original
IMPORTANTE: El método slice es un método no destructivo</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            dCtrl.visibleClientsList = dCtrl.clientList.slice((page<span class="hljs-number">-1</span>)*<span class="hljs-number">10</span>,(page<span class="hljs-number">-1</span>)*<span class="hljs-number">10</span>+<span class="hljs-number">10</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Se actualiza variable para que no despliegue el formulario de edición</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            dCtrl.showEdit = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>return false;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        }
        
        <span class="hljs-comment">/**
         * Verifica si la página entregada como parámetro corresponde a la 
         * página actual
         * @param   int        page página actual a validar 
         * @returns boolean    true si la página entregada como parámetro corrsponde 
         *                          a la página actual
         */</span>
        dCtrl.isCurrentPage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">page</span>)</span>{
            <span class="hljs-keyword">return</span> page === dCtrl.currentPage;
        }
        
        <span class="hljs-comment">/**
         * Verfica si lapagina actual es o no es la 1era página
         * @returns boolean true si la página actual es la 1era página
         */</span>
        dCtrl.isFirstPage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{            
            <span class="hljs-keyword">return</span> dCtrl.currentPage === <span class="hljs-number">1</span> &amp;&amp; dCtrl.currentPage &gt;= <span class="hljs-number">1</span>;
        }
        
        <span class="hljs-comment">/**
         * Verifica si la página actual es o no la última página
         * @returns boolean true si la página actual es la última página
         */</span>
        dCtrl.isLastPage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{            
            <span class="hljs-keyword">return</span> dCtrl.currentPage === dCtrl.totalPages &amp;&amp; dCtrl.currentPage &lt;= dCtrl.totalPages;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Inicializa las variables para el despliegue de la pantalla</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        init();
    });</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
